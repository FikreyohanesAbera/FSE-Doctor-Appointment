<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FindDoctor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Navbar</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/register">Register</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/login">Login</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container mt-4">
        <div class="jumbotron">
            <h1 class="display-4">Search Doctors </h1>
            <hr class="my-4">
                 <input type="text" id="searchInput"  name="name" placeholder="Search..."  class="form-control"/>
               
              <ul id="results" class="list-unstyled row">

              </ul>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <script type="text/javascript">
        const searchInput = document.querySelector('#searchInput')
        const results_body = document.querySelector('#results')
        load_data();
        function load_data(query = ''){
            console.log("I'm here")
            fetch(`/search/doctors?q=${query}`)
                .then((response) => response.json())
                .then((data) => {
                    console.log(data); 
                    results = data;
                    let html = '';
                    if (results.length > 0){
                        card_id = 0
                        results.forEach(result => {
                            html += `<li class="col-12 my-2" class="doctor-card"><div class="card p-4"><ul class="card-img list-unstyled">
                                <li> Name: &nbsp;`+ result.firstName + " " + result.lastName + `</li>
                                <li> ID:&nbsp;`+ result.id+`</li>
                                <li> Specialization:&nbsp;`+ result.specialization+`</li>
                                <li> Rating:&nbsp;`+ result.rating +`</li>

                            </ul> 
                            <div class="card-body ">
                                <button href="/book" class="book-doctor" id="`+ result.id +`">book appointment</button>
                            </div>
                        </div> </li>`;
                        card_id += 1;
                        });
                    } 
                    else{
                        html += `<li> No data found</li>`
                    }
                    results_body.innerHTML = html;
                
                })
                .catch(function (err) {
                    console.log("Something went wrong!", err);
                });
            }
        searchInput.addEventListener('input', () => {
            const query = searchInput.value;
            load_data(query);
        });
            
        results_body.addEventListener("click", (e)=>{
            if (e.target.className == "book-doctor"){
                console.log("yes", Number(e.target.id))
                fetch('/book/doctor', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                                doctorid: Number(e.target.id)
                            },
            
                        ),
                }).then(res => res.json())
                .then((json) => {
                    window.location = json.url
                })
                
            }
            
        })
    </script>
   
    
</body>
</html>